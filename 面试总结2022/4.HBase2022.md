#### Hbase的功能及应用场景？

功能：

- 实时中存储ETL后的结果，列式数据库。
- 离线中集合Hive，在数仓中提高查询性能

#### 什么是Namespace、Table、Rowkey、ColumnFamily、VERSIONS、store、storeFile、Region?

- Namespace：命名空间，类似于数据库

- Table：表
- Region：分区的概念，每个表对应不同的分区

- Rowkey：表的主键，HBase的精髓

- ColumnFamily：列族，每个列都必须有一个列族

- Versions：数据的版本
- Store：每个分区的数据，每个列族对应一个stored
- StoreFile：HBase将内存数据持久化到HDFS的文件

#### HBase组成结构

- 主：HMaster：管理RegionServer，管理表的元数据
- 从：RegionSever：管理分区，对外提供读写，选举HMaster
- Zookeeper：管理节点的元数据，辅助选举

#### HBase的读写流程：

- 写
  - 在ZK中找到meta表所在的regionserver地址，读取mate表数据
  - 获取表对应的region信息
  - 根据rowkey来计算属于哪个region范围，提交写入请求给对应的regionserver
  - 根据列族来判断region属于哪个store
  - 先写入memstore
  - memstore达到条件会进行flush，写入HDFS，编程Strorefile文件
- 读
  - 现在ZK中找到meta表所在的regionserver地址，读取mate表数据
  - 获取对应的region信息
  - 根据rowkey来计算属于哪个region范围，提交读请求给对应的regionserver
  - 根据列族来判断属于这个region哪个store
  - 先读memstore【写缓存】
  - 再读BlockCache【读缓存】
  - 最后读StoreFile

#### HBase如何保证数据安全？

HBase采用内存+磁盘的方式进行数据存储

- 在内存中，用WAL（预写日志）保证数据安全

- 在磁盘中，采用了HDFS这种具有副本机制的文件系统保证数据安全

#### HBase的存储模型LSM是什么？FLUSH,COMPACTION是什么？

- flush持久化：将HBase的数据持久化到HDFS，保证数据安全
  - 手动Flush
  - 自动Flush：设置flush的最小阈值，默认16m，自动进行持久化
- Compaction文件合并：将大量小文件合并，加快读取速度
  - 磁盘合并：
    - 轻量级合并
    - 重量级合并：将整个Store中的所有storeFile合并成为一个大的storefile
  - 内存合并：三种模式
    - 基础性basic：不做清理，所有数据都会合并
    - eager饥渴型：会把数据的过期版本过滤，剩下的小文件进行合并
    - adaptive适应型：最常用，根据数据的重复情况来判断是否要走eager模式

#### HBase数据是怎么分区的？

- 手动按照Rowkey进行分区，create 'tableName',{SPLITS=>[2,4,5]}

#### HBase热点问题如何解决？

热点问题：某个分区的数据量过多，导致当前Region负载过高，其他Region比较空闲

- 重新指定分区段或者使用hash方式进行分区
- 对rowkey进行设计

#### ROWKEY怎么设计？

- 业务原则：尽量使用最常用的查询条件作为Rowkey的前缀
- 组合原则：尽量使用常用查询条件组合作为rowkey
- 散列原则：构建不连续的rowkey，反转，加盐保证分区数据的均匀

#### HBase有哪些优化？

- 内存分配：给RegionServer分配更多的内存
- 压缩机制：指定的列族进行压缩：snappy
- 布隆过滤：在生成Storefile文件时，将rowkey写在文件头部，这样在查询时，只对比头部rowkey即可，有三种模式：
  - none：不开启
  - row：开启行级过滤，只将rowkey写在头部
  - rowcol：开启列级，将rowkey和列族信息都写在文件头部
  - 二级索引，对rowkey进行设计
  - bulkload：大批量数据进入内存时，可以直接用bulkload直接编程storefile文件放入HDFS

#### Phoenix组件实现了Hbase的二级索引

- 全局索引：
  - 功能：建立索引表，指定一列作为索引
  - 结果从原表里拿，如果需要查询其他列，这种方式就失效了，一般不用
- 覆盖索引：
  - 功能：指定几列作为索引，并把列的数据也写入的索引表
  - 结果可以直接从索引表里拿出来
- 本地索引：
  - 功能：本质上不创建索引表，直接将索引存在原表中，rowkey形式:startkey+列1+列2+..+原表rowkey
  - 读依旧是全局扫描，效果查，写性能比较好，但是对原表进行了修改。





