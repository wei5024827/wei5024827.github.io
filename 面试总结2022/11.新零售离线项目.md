#### 项目架构

数据采集：Sqoop

数据存储：HDFS

数据分层：

- ODS：原始数据层
- DW：
  - DWD：明细数据层
  - DWB：对明细数据进行维度聚合
  - DWS：主题宽表
- DM: 数据集市
- RPT：最终需求指标

计算引擎：Hive，Presto

工作流调度工具：Oozie



#### 主题划分

- 销售主题：
  - **指标**：销售收入、平台收入、配送成交额、小程序成交额、安卓APP成交额、苹果APP成交额、PC商城成交额、订单量、参评单量、差评单量、配送单量、退款单量、小程序订单量、安卓APP订单量、苹果APP订单量、PC商城订单量。
  - **维度**：日期、城市、商圈、店铺、品牌、大类、中类、小类。
- 商品主题：
  - **指标**：下单次数、下单件数、下单金额、被支付次数、被支付金额、被退款次数、被退款件数、被退款金额、被加入购物车次数、被加入购物车件数、被收藏次数、好评数、中评数、差评数。
  - **维度**：商品，日期
- 用户主题：
  - **指标：**登录次数、收藏店铺数、收藏商品数、加入购物车次数、加入购物车金额、下单次数、下单金额、支付次数、支付金额。
  - **维度：**用户、日期。

#### 分层设计

- ODS：涉及到50多张源表

- DWD：将源表进行过滤，字段，填充值
- DW：
  - DWB层：对DWD层的数据进行汇总，汇总成为明细宽表
    - 订单明细宽表，把有关订单的所有信息都记录再这张表中
      - 订单明细，用户明细，派送明细，评价明细
    - 店铺明细宽表：
      - 店铺明细，店铺所在地明细
    - 商品明细宽表：
      - 商品明细，商品所在商店，历史最高最低价，是否参与活动，秒杀价，库存
  - DWS层：对DWB的数据按照日维度进行聚合，组成宽表
    - 销售主题日：
      - 销售收入，平台收入，小程序，安卓，IOS成交额，退款单量
    - 商品主题日：
      - 下单次数，下单件书数，下单金额，收藏数，好评数，退款数
    - 用户主题日：
      - 用户下单数，下单金额，登录次数，收藏次数
- DM：与DWS层指标一样，添加了年，月，周的数据
- RPT层：
  - 销售主题报表：
    - 门店月销售单量排行
    - 日销售曲线
    - 渠道销量占比
  - 商品主题报表：
    - 销量TOPN
    - 收藏TOPN
    - 退款TOPN
    - 差评TOPN
  - 用户主题报表：
    - 日活，月活
    - 付费率
    - ARPU

#### 数据量

- 每日数据增量：
  - 表总数：300张
  - 核心表数量：100张
  - 数据增量：27万条左右，30G

#### 技术架构

hadoop，hdfs，hive，yarn，zookeeper，presto，Oozie



#### 为什么用presto

presto可以操作多种数据库

presto查询引擎比Hive快很多

在最终的RPT中聚合并输出到Hive，数据量太大，计算很慢，presto解决了这个问题，并用presto导出数据到mysql

